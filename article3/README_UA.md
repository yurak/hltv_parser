# Аналіз інваріантності ознак для статистики гравців CS2/CSGO

## Огляд

Це дослідження вивчає **властивості інваріантності** ознак продуктивності гравців у трьох вимірах:
1. **Карти** (de_train, de_nuke, de_inferno, de_mirage, de_dust2, de_vertigo, de_ancient, de_anubis)
2. **Версії гри** (Counter-Strike 2 vs Counter-Strike: Global Offensive)
3. **Сторони** (Терористи vs Контр-терористи)

Розуміння інваріантності ознак є критичним для:
- Побудови робастних моделей оцінки скілу гравців, що узагальнюються на різні контексти
- Визначення метрик, які справді відображають індивідуальні здібності гравця, а не ситуативні фактори
- Відбору ознак для моделей машинного навчання в кіберспортивній аналітиці

## Набір даних

| Параметр | Значення |
|----------|----------|
| Всього записів | 3 486 |
| Записів CS2 | 1 820 |
| Записів CSGO | 1 666 |
| Карт | 8 |
| Числових ознак | 104 |

Ознаки включають метрики продуктивності за категоріями: вогнева міць, трейдинг, відкриваючі дуелі, клатчі, снайпінг та використання утиліт.

## Методи

### 1. Інваріантність по картах: ANOVA з Eta-squared

**Метод:** Однофакторний дисперсійний аналіз (ANOVA) з розміром ефекту eta-squared (η²)

**Чому обрано цей метод:**
- ANOVA є стандартним підходом для порівняння середніх значень **більш ніж двох груп** (8 карт)
- F-тест визначає, чи є статистично значущі відмінності між групами карт
- **Eta-squared** надає міру розміру ефекту, незалежну від розміру вибірки

**Інтерпретація η²:**
| Значення η² | Розмір ефекту |
|-------------|---------------|
| < 0.01 | Незначний |
| 0.01 - 0.06 | Малий |
| 0.06 - 0.14 | Середній |
| > 0.14 | Великий |

**Обраний поріг:** η² < 0.06 (малий ефект) вказує на інваріантні до карти ознаки

**Формула:**
```
η² = SS_between / SS_total
```

Де:
- SS_between = Σ nᵢ(x̄ᵢ - x̄)² (дисперсія між групами)
- SS_total = Σ(xᵢⱼ - x̄)² (загальна дисперсія)

### 2. Інваріантність по версіях гри: Mann-Whitney U з Cohen's d

**Метод:** Критерій Манна-Уітні (непараметричний) з розміром ефекту Cohen's d

**Чому обрано цей метод:**
- Критерій Манна-Уітні є **стійким до ненормальних розподілів**, типових для ігрової статистики
- На відміну від t-тесту, не передбачає рівних дисперсій чи нормальності
- Добре працює з помірними розмірами вибірок у кожній групі (~1 700-1 800)
- **Cohen's d** кількісно оцінює практичну значущість відмінностей

**Інтерпретація Cohen's d:**
| Значення d | Розмір ефекту |
|------------|---------------|
| < 0.2 | Незначний |
| 0.2 - 0.5 | Малий |
| 0.5 - 0.8 | Середній |
| > 0.8 | Великий |

**Обраний поріг:** d < 0.5 (малий-середній ефект) вказує на інваріантні до версії ознаки

**Формула:**
```
d = |μ₁ - μ₂| / σ_pooled

де σ_pooled = √((σ₁² + σ₂²) / 2)
```

### 3. Інваріантність по сторонах: Парний t-тест з Cohen's d

**Метод:** Парний t-тест з Cohen's d для парних даних

**Чому обрано цей метод:**
- Кожен гравець має **парні спостереження** (статистика CT та T з тих самих матчів)
- Парний t-тест враховує внутрішньосуб'єктну кореляцію, збільшуючи статистичну потужність
- Більш доречний, ніж тест для незалежних вибірок, коли дані природно парні
- Зменшує дисперсію від індивідуальних відмінностей гравців

**Формула для парного Cohen's d:**
```
d = |μ_diff| / σ_diff

де μ_diff = mean(CT - T) та σ_diff = std(CT - T)
```

### 4. Зниження розмірності: PCA

**Метод:** Аналіз головних компонент (PCA)

**Чому обрано цей метод:**
- Візуалізує багатовимірний простір ознак у 2D
- Виявляє патерни кластеризації по картах/версіях без вчителя
- Показує, чи групи є розділимими в просторі ознак
- PC1 та PC2 захоплюють напрямки максимальної дисперсії

## Підсумок результатів

### Інваріантність по картах
- **27 ознак (75%)** є інваріантними до карт
- Найбільш інваріантні: `opening_deaths_per_round`, `opening_attempts`, `opening_kills_per_round`
- Найбільш варіантні: `utility`, `utility_damage_per_round`, `flashes_thrown_per_round`

**Інтерпретація:** Статистика відкриваючих дуелей є стабільною на різних картах, тоді як використання утиліт значно варіюється (різні карти потребують різних стратегій з гранатами).

### Інваріантність по версіях гри (CS2 vs CSGO)
- **33 ознаки (91.7%)** є інваріантними до версій
- Найбільш інваріантні: `opening_deaths_per_round`, `utility`, `clutch_points_per_round`
- Найбільш варіантні: `assisted_kills_percentage`, `assists_per_round`, `support_rounds`

**Інтерпретація:** Базові механічні навички переносяться між версіями гри, але оновлена механіка CS2 змінила патерни командної координації (асисти, підтримка).

### Інваріантність по сторонах (T vs CT)
- **14 ознак (48.3%)** є інваріантними до сторін
- Найбільш інваріантні: `opening_attempts`, `entrying`, `pistol_round_rating`, `clutching`
- Найбільш варіантні: `saves_per_round_loss`, `utility_damage_per_round`, `flashes_thrown_per_round`

**Інтерпретація:** Сторона має найбільший вплив на розподіл ознак. CT сторона більше сейвить (захист економіки), використовує більше damage від утиліт (утримання позицій), тоді як T сторона кидає менше флешок (менша потреба чистити кути).

### Універсально інваріантні ознаки (всі три виміри)

Ці 11 ознак є стабільними на різних картах, версіях гри ТА сторонах:

| Ознака | Опис |
|--------|------|
| `rating_3.0` | Загальний рейтинг гравця |
| `firepower` | Здатність до фрагів |
| `opening` | Участь у відкриваючих дуелях |
| `opening_attempts` | Частота перших боїв |
| `pistol_round_rating` | Продуктивність у пістолетних раундах |
| `clutching` | Гра в клатч-ситуаціях |
| `clutch_points_per_round` | Внесок у клатчі |
| `entrying` | Схильність до entry-фрагів |
| `sniping` | Стиль гри з AWP/снайперкою |
| `sniper_multi_kill_rounds` | Раунди з мультікілами снайперкою |
| `sniper_opening_kills_per_round` | Опенінг кіли снайперкою |

**Ключовий висновок:** Ці ознаки представляють **внутрішні навички гравця**, які зберігаються незалежно від контексту. Вони є ідеальними кандидатами для моделювання скілу гравців та скаутингу талантів.

## Візуалізації

### 1. Підсумок інваріантності (`invariance_summary.png`)
Три горизонтальні стовпчикові діаграми, що показують розміри ефектів для кожного виміру аналізу. Зелені стовпчики позначають інваріантні ознаки, червоні — варіантні.

### 2. PCA візуалізація (`pca_visualization.png`)
- Ліворуч: Точки пофарбовані по картах — показує мінімальну кластеризацію по картах
- Центр: Точки пофарбовані по версіях гри — CS2 та CSGO значно перекриваються
- Праворуч: Точки пофарбовані по комбінації гра+карта

### 3. Порівняння сторін (`side_comparison.png`)
Парна стовпчикова діаграма, що порівнює середні значення CT vs T для топ-25 ознак. Помітні відмінності у `damage_per_round`, `saves_per_round_loss` та `utility_damage_per_round`.

### 4. Розподіли ознак (`feature_distributions.png`)
Гістограми щільності, що порівнюють розподіли CS2 vs CSGO для ключових ознак: kills_per_round, damage_per_round, rating_3.0, opening_kills_per_round, utility_damage_per_round, sniper_kills_per_round.

## Файли

| Файл | Опис |
|------|------|
| `feature_invariance_analysis.py` | Основний скрипт аналізу |
| `map_invariance_results.csv` | Детальні результати ANOVA по кожній ознаці |
| `version_invariance_results.csv` | Детальні результати Mann-Whitney по кожній ознаці |
| `side_invariance_results.csv` | Детальні результати парного t-тесту по кожній ознаці |
| `invariant_features_summary.txt` | Текстовий підсумок списків інваріантних ознак |
| `invariance_summary.png` | Візуалізація порівняння розмірів ефектів |
| `pca_visualization.png` | PCA проекції по групуванням |
| `side_comparison.png` | Порівняння ознак CT vs T |
| `feature_distributions.png` | Графіки розподілів CS2 vs CSGO |

## Обґрунтування вибору методів

### Чому не лише p-values?

P-values самі по собі є проблематичними, оскільки:
1. При великих вибірках (n > 3000) навіть крихітні відмінності стають "статистично значущими"
2. P-values не вказують на практичну важливість
3. Вони сильно залежать від розміру вибірки

**Рішення:** Ми використовуємо розміри ефектів (η², Cohen's d), які є масштабно-незалежними мірами практичної значущості.

### Чому різні тести для кожного аналізу?

| Аналіз | Групи | Структура даних | Відповідний тест |
|--------|-------|-----------------|------------------|
| Карти | 8 груп | Незалежні | ANOVA |
| Версії | 2 групи | Незалежні | Mann-Whitney U |
| Сторони | 2 групи | Парні (той самий гравець) | Парний t-тест |

### Чому непараметричний тест для порівняння версій?

Ігрова статистика часто має:
- Скошені розподіли (багато середніх гравців, мало елітних)
- Викиди (виняткові виступи)
- Ненормальні залишки

Критерій Манна-Уітні не робить припущень щодо розподілу, що робить його більш робастним для цих даних.

## Висновки

1. **Більшість ознак є інваріантними до карт та версій** — скіл гравця переважно переноситься між контекстами
2. **Сторона має найбільший вплив** — T та CT потребують принципово різних стилів гри
3. **11 "універсальних" ознак** відображають контекстно-незалежні здібності гравця
4. **Ознаки, пов'язані з утилітами** є найбільш контекстно-залежними (специфічні для карти та сторони)
5. **Статистика відкриваючих дуелей** є високо стабільною — індивідуальний скіл у перших боях є консистентним

## Використання

```bash
python3 feature_invariance_analysis.py
```

Залежності: pandas, numpy, scipy, sklearn, matplotlib, seaborn

## Джерела

Джерело даних: HLTV.org статистика гравців
Період аналізу: CS2 (2023-09-27 до 2025-12-31), CSGO (2012-08-21 до 2023-09-26)
